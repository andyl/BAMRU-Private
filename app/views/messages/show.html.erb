<%= javascript_include_tag "messages/all_messages_show" %>

<div id=x_container>
  <div id=x_body>
    <div id=x_header>
      <table width=100%>
        <tr>
          <td width=50% align=left>
            <b>Message #<%= @message.id %> Detail</b>
          </td>
          <td width=50% align=right>
            <%= link_to("Unit Message Log", messages_path) %>
          </td>
        </tr>
      </table>
    </div>

    <div id=x_single_col>
      <table>
        <tr>
          <td align=right width=150><b>Message ID:</b></td>
          <td><%= @message.id %></td>
        </tr>
        <tr>
          <td align=right width=150><b>Message Date:</b></td>
          <td><%= @message.created_at.strftime("%y-%m-%d %H:%M:%S") %></td>
        </tr>
        <tr>
          <td align=right><b>Message Author:</b></td>
          <td>
            <%= link_to(@message.author.full_name, member_path(@message.author)) %>
            (IP Address: <%= @message.ip_address %>)
          </td>
        </tr>
        <tr>
          <td align=right><b>Message Text:</b></td>
          <td><%= @message.text_with_rsvp %></td>
        </tr>
        <tr>
          <td align=right><b>Transmission:</b></td>
          <td>
            Sent <%= @message.recipients.length %>,
            Read <%= @message.distributions.read.length %>,
            Bounced <%= @message.distributions.bounced.length %>
          </td>
        </tr>
        <tr>
          <td align=right><b>Response Time:</b></td>
          <td><%= raw response_time_display(@message) %></td>
        </tr>
        <tr>
          <td align=right><b>RSVP:</b></td>
          <td><%= rsvp_display(@message) %></td>
        </tr>
      </table>

      <% if @message.distributions.count > 4 %>
        <div style='text-align: center; margin-bottom: 0px; background-color: lightgray; padding: 3px;'>
          Search: <input name="filter" id="filter-box" value="" maxlength="22" size="22" type="text">
          <input id="filter-clear-button" type="button" value="Clear"/>
        </div>
      <% end %>

      <table id=myTable class="tablesorter">
        <thead>
        <th>Recipient</th>
        <th>Bounced?</th>
        <th>Read?</th>
        <th>RSVP</th>
        <th align=center>Detail</th>
        </thead>
        <% @message.distributions.each do |d| %>
          <tr>
            <td><%= link_to(d.member.full_name, member_path(d.member)) %></td>
            <td align=center><%= raw yes_no_bounce d.bounced %></td>
            <td align=center><%= raw yes_no_read d.read %></td>
            <td align=center><%= raw d.rsvp_display_link %></td>
            <td align=center>
              <%= link_to("history", history_path(d))%> |
              <%= link_to("inbox", member_inbox_index_path(d.member)) %>
            </td>
          </tr>
        <% end %>
      </table>

    </div>
    <div id=x_footer style='font-size: 8pt;'>
      If there are bounced messages, check the <b>history</b> to find out what is failing.
    </div>

  </div>
</div>